webpackJsonp([3],{K2CU:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("M4fF"),l=a.n(r),o=a("PJh5"),s=a.n(o),i={data:function(){return{params:{pagination:{pageNo:1,pageSize:20,totalCount:100},query:{roleName:"",roleStatus:""}},addFormVisible:!1,formLabelWidth:"120px",roleInfo:{id:"",roleName:"",roleStatus:1},statusList:[{value:"",label:"全部"},{value:1,label:"可用"},{value:0,label:"禁用"}],roleList:[],loading:!1,resourceTree:[],authDialogVisible:!1,currAuthRoleId:""}},computed:{queryCondition:function(){var e=l.a.assign({},this.params.pagination);return e=l.a.assign(e,this.params.query)},dialogTitle:function(){return"添加角色"},leftSpan:function(){return 1===this.params.query.accountType?10:13},checkedIds:function(){var e=[];for(var t in this.resourceTree)this.resourceTree[t].selected&&e.push(this.resourceTree[t].id),this.addSubIds(e,this.resourceTree[t].subItems);return e}},mounted:function(){this.fetchList()},attached:function(){},methods:{saveRoleResource:function(){var e=this;console.log(this.checkedIds),this.$http.post("admin/sys/role/saveRoleResource",{roleId:this.currAuthRoleId,resourceIds:this.checkedIds}).then(function(t){e.$message("保存成功"),e.currAuthRoleId="",e.authDialogVisible=!1})},addSubIds:function(e,t){for(var a in t)t[a].selected&&e.push(t[a].id),this.addSubIds(e,t[a].subItems)},handleCheckItem:function(e,t){t.selected&&(e.selected=!0)},handleCheckAll:function(e){var t=e.selected;for(var a in e.subItems)e.subItems[a].selected=t},formatDate:function(e,t){return s()(e[t.property]).format("YYYY-MM-DD HH:mm")},formatStatus:function(e,t){return 1===e[t.property]?"可用":"禁用"},handleSizeChange:function(e){this.params.pagination.pageSize=e,this.fetchList()},handleCurrentChange:function(e){this.params.pagination.pageNo=e,this.fetchList()},addUser:function(){console.log("add user"),this.roleInfo={id:"",roleName:"",roleStatus:1},this.addFormVisible=!0},editUser:function(e){this.addFormVisible=!0,this.roleInfo=e},editRoleResource:function(e){this.currAuthRoleId=e.id,this.fetchResourceTree(e.id)},save:function(){var e=this;this.$http.post("admin/sys/role/save",this.roleInfo).then(function(t){e.$message("保存成功"),e.fetchList(),e.addFormVisible=!1})},fetchList:function(){var e=this;this.$http.get("admin/sys/role/list",{params:this.queryCondition}).then(function(t){e.roleList=t.data.data.listData,e.params.pagination.totalCount=t.data.data.totalCount},function(e){console.log(e)})},fetchResourceTree:function(e){var t=this;this.$http.get("admin/sys/role/tree?roleId="+e).then(function(e){t.resourceTree=e.data.data,t.authDialogVisible=!0},function(e){console.log(e)})}},components:{}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("main",[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[e._v("首页")]),e._v(" "),a("el-breadcrumb-item",[e._v("系统管理")]),e._v(" "),a("el-breadcrumb-item",[e._v("角色管理")])],1),e._v(" "),a("div",{staticStyle:{"margin-top":"10px"}},[a("el-form",{attrs:{inline:!0}},[a("div",{staticClass:"queryForm"},[a("el-form-item",[a("el-input",{attrs:{placeholder:"角色名称"},model:{value:e.params.query.roleName,callback:function(t){e.$set(e.params.query,"roleName",t)},expression:"params.query.roleName"}})],1),e._v(" "),a("el-form-item",[a("el-select",{attrs:{placeholder:"状态"},model:{value:e.params.query.roleStatus,callback:function(t){e.$set(e.params.query,"roleStatus",t)},expression:"params.query.roleStatus"}},e._l(e.statusList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{nativeOn:{click:function(t){return t.preventDefault(),e.fetchList(t)}}},[a("i",{staticClass:"fa fa-search",attrs:{"aria-hidden":"true"}}),e._v("\n            查询\n          ")])],1)],1),e._v(" "),a("div",{staticClass:"addOperate"},[a("el-button",{nativeOn:{click:function(t){return t.preventDefault(),e.addUser(t)}}},[a("i",{staticClass:"fa fa-plus",attrs:{"aria-hidden":"true"}}),e._v("\n          添加角色\n        ")])],1)])],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.roleList,stripe:"",border:""}},[a("el-table-column",{attrs:{property:"id",label:"ID"}}),e._v(" "),a("el-table-column",{attrs:{property:"roleName",label:"角色名称"}}),e._v(" "),a("el-table-column",{attrs:{property:"createTime",label:"创建时间",formatter:e.formatDate}}),e._v(" "),a("el-table-column",{attrs:{property:"roleStatus",label:"状态",formatter:e.formatStatus}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},nativeOn:{click:function(a){a.preventDefault(),e.editUser(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"text"},nativeOn:{click:function(a){a.preventDefault(),e.editRoleResource(t.row)}}},[e._v("分配权限")])]}}])})],1),e._v(" "),a("div",{staticClass:"page-block"},[a("el-pagination",{attrs:{"current-page":e.params.pagination.pageNo,"page-sizes":[20,50,100,200],"page-size":e.params.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.params.pagination.totalCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.addFormVisible},on:{"update:visible":function(t){e.addFormVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.roleInfo,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"角色名称","label-width":e.formLabelWidth}},[a("el-input",{model:{value:e.roleInfo.roleName,callback:function(t){e.$set(e.roleInfo,"roleName",t)},expression:"roleInfo.roleName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"状态","label-width":e.formLabelWidth}},[a("el-select",{attrs:{placeholder:"状态"},model:{value:e.roleInfo.roleStatus,callback:function(t){e.$set(e.roleInfo,"roleStatus",t)},expression:"roleInfo.roleStatus"}},e._l(e.statusList,function(t){return""!==t.value?a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}}):e._e()}))],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.addFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"权限分配",visible:e.authDialogVisible},on:{"update:visible":function(t){e.authDialogVisible=t}}},[e._l(e.resourceTree,function(t){return a("div",{key:t.id,staticStyle:{"margin-top":"10px"}},[a("el-card",{staticClass:"box-card"},[a("el-checkbox",{on:{change:function(a){e.handleCheckAll(t)}},model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"item.selected"}},[e._v(e._s(t.resourceName))]),e._v(" "),a("div",{staticStyle:{margin:"5px 10px"}}),e._v(" "),a("span",{staticStyle:{"margin-left":"20px"}}),e._v(" "),e._l(t.subItems,function(r){return a("el-checkbox",{key:r.id,attrs:{label:r.resourceName},on:{change:function(a){e.handleCheckItem(t,r)}},model:{value:r.selected,callback:function(t){e.$set(r,"selected",t)},expression:"subItem.selected"}})})],2)],1)}),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.authDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.saveRoleResource}},[e._v("确 定")])],1)],2)],1)},staticRenderFns:[]};var u=a("VU/8")(i,n,!1,function(e){a("wzRJ")},"data-v-9a856b5e",null);t.default=u.exports},wzRJ:function(e,t){}});
//# sourceMappingURL=3.7bda2814e3c3cf638df0.js.map